(function(c,b){var a=b.customize;a.HeaderTool={},a.HeaderTool.ImageModel=Backbone.Model.extend({defaults:function(){return{header:{attachment_id:0,url:'',timestamp:_.now(),thumbnail_url:''},choice:'',selected:!1,random:!1}},initialize:function(){this.on('hide',this.hide,this)},hide:function(){this.set('choice',''),a('header_image').set('remove-header'),a('header_image_data').set('remove-header')},destroy:function(){var c=this.get('header'),d=a.HeaderTool.currentHeader.get('header').attachment_id;d&&c.attachment_id===d&&a.HeaderTool.currentHeader.trigger('hide'),b.ajax.post('custom-header-remove',{nonce:_wpCustomizeHeader.nonces.remove,wp_customize:'on',theme:a.settings.theme.stylesheet,attachment_id:c.attachment_id}),this.trigger('destroy',this,this.collection)},save:function(){this.get('random')?(a('header_image').set(this.get('header').random),a('header_image_data').set(this.get('header').random)):this.get('header').defaultName?(a('header_image').set(this.get('header').url),a('header_image_data').set(this.get('header').defaultName)):(a('header_image').set(this.get('header').url),a('header_image_data').set(this.get('header'))),a.HeaderTool.combinedList.trigger('control:setImage',this)},importImage:function(){var c=this.get('header');if(c.attachment_id===void 0)return;b.ajax.post('custom-header-add',{nonce:_wpCustomizeHeader.nonces.add,wp_customize:'on',theme:a.settings.theme.stylesheet,attachment_id:c.attachment_id})},shouldBeCropped:function(){return!(this.get('themeFlexWidth')===!0&&this.get('themeFlexHeight')===!0)&&(!(this.get('themeFlexWidth')===!0&&this.get('themeHeight')===this.get('imageHeight'))&&(!(this.get('themeFlexHeight')===!0&&this.get('themeWidth')===this.get('imageWidth'))&&(!(this.get('themeWidth')===this.get('imageWidth')&&this.get('themeHeight')===this.get('imageHeight'))&&(!(this.get('imageWidth')<=this.get('themeWidth'))))))}}),a.HeaderTool.ChoiceList=Backbone.Collection.extend({model:a.HeaderTool.ImageModel,comparator:function(a){return-a.get('header').timestamp},initialize:function(){var b=a.HeaderTool.currentHeader.get('choice').replace(/^https?:\/\//,''),c=this.isRandomChoice(a.get().header_image);this.type||(this.type='uploaded'),typeof this.data=='undefined'&&(this.data=_wpCustomizeHeader.uploads),c&&(b=a.get().header_image),this.on('control:setImage',this.setImage,this),this.on('control:removeImage',this.removeImage,this),this.on('add',this.maybeRemoveOldCrop,this),this.on('add',this.maybeAddRandomChoice,this),_.each(this.data,function(a,c){a.attachment_id||(a.defaultName=c),typeof a.timestamp=='undefined'&&(a.timestamp=0),this.add({header:a,choice:a.url.split('/').pop(),selected:b===a.url.replace(/^https?:\/\//,'')},{silent:!0})},this),this.size()>0&&this.addRandomChoice(b)},maybeRemoveOldCrop:function(b){var c=b.get('header').attachment_id||!1,a;if(!c)return;a=this.find(function(a){return a.cid!==b.cid&&a.get('header').attachment_id===c}),a&&this.remove(a)},maybeAddRandomChoice:function(){this.size()===1&&this.addRandomChoice()},addRandomChoice:function(b){var c=RegExp(this.type).test(b),a='random-'+this.type+'-image';this.add({header:{timestamp:0,random:a,width:245,height:41},choice:a,random:!0,selected:c})},isRandomChoice:function(a){return/^random-(uploaded|default)-image$/.test(a)},shouldHideTitle:function(){return this.size()<2},setImage:function(a){this.each(function(a){a.set('selected',!1)}),a&&a.set('selected',!0)},removeImage:function(){this.each(function(a){a.set('selected',!1)})}}),a.HeaderTool.DefaultsList=a.HeaderTool.ChoiceList.extend({initialize:function(){this.type='default',this.data=_wpCustomizeHeader.defaults,a.HeaderTool.ChoiceList.prototype.initialize.apply(this)}})})(jQuery,window.wp)