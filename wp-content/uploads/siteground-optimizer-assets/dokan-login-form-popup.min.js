(function(a){dokan.login_form_popup={form_html:'',init:function(){a('body').on('dokan:login_form_popup:show',this.get_form),a('body').on('submit','#dokan-login-form-popup-form',this.submit_form),a('body').on('dokan:login_form_popup:working',this.working),a('body').on('dokan:login_form_popup:done_working',this.done_working)},get_form:function(c,b){if(dokan.login_form_popup.form_html){dokan.login_form_popup.show_popup();return}b=a.extend(!0,{nonce:dokan.nonce,action:'dokan_get_login_form'},b),a('body').trigger('dokan:login_form_popup:fetching_form'),a.ajax({url:dokan.ajaxurl,method:'get',dataType:'json',data:{_wpnonce:b.nonce,action:b.action}}).done(function(b){dokan.login_form_popup.form_html=b.data,dokan.login_form_popup.show_popup(),a('body').trigger('dokan:login_form_popup:fetched_form')})},show_popup:function(){a.magnificPopup.open({items:{src:dokan.login_form_popup.form_html,type:'inline'},callbacks:{open:function(){a('body').trigger('dokan:login_form_popup:opened')}}})},submit_form:function(d){var c,b;d.preventDefault(),c=a(this).serialize(),b=a('.dokan-login-form-error','#dokan-login-form-popup-form'),b.removeClass('has-error').text(''),a('body').trigger('dokan:login_form_popup:working'),a.ajax({url:dokan.ajaxurl,method:'post',dataType:'json',data:{_wpnonce:dokan.nonce,action:'dokan_login_user',form_data:c}}).done(function(b){a('body').trigger('dokan:login_form_popup:logged_in',b),a.magnificPopup.close()}).always(function(){a('body').trigger('dokan:login_form_popup:done_working')}).fail(function(a){a.responseJSON&&a.responseJSON.data&&a.responseJSON.data.message&&b.addClass('has-error').text(a.responseJSON.data.message)})},working:function(){a('fieldset','#dokan-login-form-popup-form').prop('disabled',!0),a('#dokan-login-form-submit-btn').addClass('dokan-hide'),a('#dokan-login-form-working-btn').removeClass('dokan-hide')},done_working:function(){a('fieldset','#dokan-login-form-popup-form').prop('disabled',!1),a('#dokan-login-form-submit-btn').removeClass('dokan-hide'),a('#dokan-login-form-working-btn').addClass('dokan-hide')}},dokan.login_form_popup.init()})(jQuery)